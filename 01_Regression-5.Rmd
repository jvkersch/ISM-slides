---
title: "Chapter 7: Linear regression"
subtitle: "Categorical variables"
author: "Joris Vankerschaver"
header-includes:
  - \usepackage{multicol}
  - \usepackage{color}
  - \usepackage{Ghent}
  - \usepackage{alltt}
output: 
  beamer_presentation:
    theme: "AnnArbor"
    colortheme: "dolphin"
    keep_tex: true
---

```{r include = FALSE}
birnh <- read.table("./datasets/01-linear-regression/birnh.txt", header = T, sep = "\t", dec = ".")
attach(birnh)
```
## Example: BIRNH study

\begin{itemize}
\item Epidemiological follow-up study in the mid 80s where nutritional and health data in Belgium were measured ($n=5,815$)
\item \alert{Goal}: effect of smoking on cholesterol
\item Since people from different provinces might have a different smoking and dietary behaviour, we want to correct for province
\item Possible values of this variable:
\begin{itemize}
\item 1: West Flanders
\item 2: East Flanders
\item 3: Flemish Brabant
\item 7: Antwerp
\item 8: Limburg
\end{itemize}
\end{itemize}

## A first analysis ...

\small
```{r echo=FALSE}
model_birnh <- lm(TCHOL ~ SMOKING + AGE + I(AGE^2) + I(AGE^3) + SEX + PROVINCE)
summary(model_birnh)$coefficients
```
\normalsize
Model implicitly assumes that mean difference in cholesterol 
\begin{itemize}
\item between Limburg and West-Flanders is 7 times as large as 
\item the one between East- and West-Flanders
\end{itemize}

## Dummy variables

\begin{itemize}
\item Create 4 \alert{dummy variables}
\begin{eqnarray*}
P_2 & = & \left\{\begin{array}{ll}
1 & \textrm{East Flanders}\\
0 & \textrm{other}
\end{array}\right.\\
P_3 & = &\left\{\begin{array}{ll}
1 & \textrm{Flemish Brabant}\\
0 & \textrm{other}
\end{array}\right.\\
P_7 & = & \left\{\begin{array}{ll}
1 & \textrm{Antwerp}\\
0 & \textrm{other}
\end{array}\right.\\
P_8 & = & \left\{\begin{array}{ll}
1 & \textrm{Limburg}\\
0 & \textrm{other}
\end{array}\right.\\
\end{eqnarray*}
\end{itemize}

## Dummy variables

\begin{itemize}
\item These 4 dummy variables carry same information as variable PROVINCE:
\begin{itemize}
\item in West Flanders: $(P_2,P_3,P_7,P_8)=(0,0,0,0)$
\item in East Flanders: $(P_2,P_3,P_7,P_8)=(1,0,0,0)$
\item in Flemish Brabant: $(P_2,P_3,P_7,P_8)=(0,1,0,0)$
\item in Antwerp: $(P_2,P_3,P_7,P_8)=(0,0,1,0)$
\item in Limburg: $(P_2,P_3,P_7,P_8)=(0,0,0,1)$
\end{itemize}
\item Each categorical variable with $k$ levels can be transformed into $k-1$ dummy variables by choosing 1 level as \alert{reference}
\item In \texttt{R}:
\end{itemize}
```{r eval=FALSE}
m <- lm(TCHOL ~ SMOKING + AGE + I(AGE^2) + I(AGE^3) 
        + SEX + factor(PROVINCE))
```

## Analysis with dummy variables

\footnotesize
```{r echo=FALSE}
m <- lm(TCHOL ~ SMOKING + AGE + I(AGE^2) + I(AGE^3) 
        + SEX + factor(PROVINCE))
summary(m)$coefficients
```

\phantom{Necessity to test if multiple coefficients are zero}

## How to test for effect of province?

\footnotesize
```{r echo=FALSE}
m <- lm(TCHOL ~ SMOKING + AGE + I(AGE^2) + I(AGE^3) 
        + SEX + factor(PROVINCE))
summary(m)$coefficients
```
\normalsize
Necessity to test if multiple coefficients are zero

## Partial F-test

Assume we want to compare \alert{2 nested models}:
\begin{itemize}
\item \alert{Complete model (C)} with $p_C$ parameters; e.g., $p_C=10$ and
\[E(Y|X,P)=\beta_0+\beta_1X+\beta_2P\]
\item \alert{Reduced model (R)} with $p_R$ parameters; e.g., $p_R=6$ and
\[E(Y|X,P)=\beta^*_0+\beta^*_1X\]
\item Testing $H_0:\beta_2=0$ is equivalent to testing if complete and reduced model are equal
\end{itemize}

## Partial F-test

\begin{itemize}
\item Under null hypothesis, residual sums of squares of both models will be approximately same
\item \alert{Test statistic}:
\[RSS(R)-RSS(C)\]
\item {What is distribution under null hypothesis?}
\[\frac{RSS(R)-RSS(C)}{p_C-p_R}\div \frac{RSS(C)}{n-p_C}\sim F_{p_C-p_R,n-p_C}\]
under null hypothesis
\end{itemize}

## Partial F-test in \texttt{R}

\footnotesize
```{r}
mC <- lm(TCHOL ~ SMOKING + AGE + I(AGE^2) + I(AGE^3) + SEX 
         + factor(PROVINCE))
mR <- lm(TCHOL ~ SMOKING + AGE + I(AGE^2) + I(AGE^3) + SEX)
anova(mR,mC)
```
